# 營造廠決策分析平台專案成果報告書

## 摘要

本專案開發一套以單一資料來源（Single Source of Truth, SSOT）為核心的營造決策分析平台，首期實作「投標最佳化決策系統」。系統採用整數線性規劃（Mixed Integer Linear Programming, MILP）模型，運用 PuLP 求解器進行最佳化運算，協助營造廠在投標階段快速評估最優工期與成本配置方案。平台採用前後端分離架構，前端使用 Vue 3 框架搭配 Element Plus 元件庫，後端採用 FastAPI 提供高效 API 服務，資料庫則選用 Supabase（PostgreSQL）確保資料完整性與擴充性。系統支援兩種決策模式：給定預算求最短工期、給定工期求最低成本，並能考慮獎懲條款進行綜合成本評估，提供視覺化圖表與報告匯出功能，為營造決策提供科學化支援。

---

## 第一章 緒論

### 1.1 研究背景

營造工程專案具有高度複雜性，涉及多項作業活動之間的前置關係、資源配置與時程管理。在投標階段，營造廠必須在有限時間內評估專案可行性，包括工期規劃、成本估算與風險評估。傳統的決策方式多依賴經驗法則或簡易試算，缺乏系統化的最佳化分析工具，容易導致決策偏誤或遺漏關鍵因素。

隨著管理科學與資訊技術的進步，整數線性規劃等數學最佳化方法已廣泛應用於工程管理領域。然而，現有工具多為獨立軟體或試算表，缺乏整合性與可擴充性，無法作為企業長期決策支援的基礎架構。因此，建立一套以單一資料來源為核心、模組化設計、可持續擴充的決策分析平台，對提升營造廠競爭力具有重要意義。

### 1.2 研究目的

本研究旨在開發一套營造廠決策分析平台，具體目的如下：

1. **建立單一資料來源（SSOT）架構**：設計統一的專案資料結構，作為未來各功能模組的共同基礎，確保資料一致性與可重用性。

2. **實作投標最佳化決策系統**：運用整數線性規劃模型，提供兩種決策模式（預算約束下求最短工期、工期約束下求最低成本），協助投標階段快速評估最優方案。

3. **整合獎懲條款計算**：考慮逾期違約金與提前完工獎金，提供更貼近實務的總成本評估。

4. **提供視覺化分析工具**：透過甘特圖、成本分析圖等視覺化元件，協助使用者快速理解最佳化結果與作業排程。

5. **支援報告自動生成**：提供 PDF 與 Excel 報告匯出功能，便於決策結果記錄與溝通。

6. **奠定平台擴充基礎**：採用模組化架構設計，支援未來新增品質管理、進度管理等功能模組。

### 1.3 研究範圍與限制

**研究範圍**：
- 專案作業活動管理（工期、成本、前置關係）
- 投標最佳化決策模型（MILP）
- 獎懲條款計算（違約金、獎金）
- 結果視覺化與報告輸出

**研究限制**：
- 不考慮資源限制（人力、機具等）
- 不考慮不確定性因素（天氣、供應鏈風險等）
- 作業工期與成本假設為確定值
- 僅考慮單一專案，不涉及多專案排程

---

## 第二章 文獻探討與理論基礎

### 2.1 專案時程成本權衡問題

專案時程成本權衡（Time-Cost Trade-off, TCT）問題是專案管理領域的經典議題。當專案需要縮短工期時，必須投入額外資源進行趕工（crashing），導致成本增加。此問題的核心在於找出最佳的作業趕工組合，使總成本最小或總工期最短。

在數學模型上，TCT 問題通常以線性規劃或整數線性規劃表示。每個作業活動具有正常工期（normal duration）與正常成本（normal cost），以及趕工工期（crash duration）與趕工成本（crash cost）。決策變數為各作業的開始時間與趕工決策，目標函數為最小化總成本或總工期，約束條件包括前置關係約束、工期約束與預算約束。

### 2.2 整數線性規劃方法

整數線性規劃（Mixed Integer Linear Programming, MILP）是作業研究中的重要工具，適用於決策變數包含連續變數與離散變數的最佳化問題。MILP 模型包含三個要素：

1. **決策變數**：包含連續變數（如開始時間）與二元變數（如是否趕工）
2. **目標函數**：線性函數，表達欲最小化或最大化的目標
3. **約束條件**：線性不等式或等式，表達決策空間的限制

常用的 MILP 求解器包括 CPLEX、Gurobi、GLPK、CBC 等。本研究採用 Python 生態系統中的 PuLP 套件，可搭配多種開源求解器，兼具效能與開發便利性。

### 2.3 單一資料來源架構

單一資料來源（Single Source of Truth, SSOT）是資料管理的重要原則，強調將特定資料僅儲存於單一位置，所有相關功能模組皆從此位置存取資料。SSOT 架構的優點包括：

- **資料一致性**：避免多處儲存導致的資料不一致問題
- **維護便利性**：資料更新僅需修改單一位置
- **擴充性**：新增功能模組可直接使用既有資料結構
- **可追溯性**：所有資料變更可統一追蹤與管理

本研究以 SSOT 原則設計資料庫架構，將專案、作業活動、前置關係等核心資料統一管理，作為未來各決策模組的共同基礎。

---

## 第三章 系統架構與設計

### 3.1 系統架構

本系統採用前後端分離的三層式架構，包含展示層（Presentation Layer）、應用層（Application Layer）與資料層（Data Layer）：

**展示層（前端）**：
- 框架：Vue 3 + Vite
- UI 元件庫：Element Plus
- 圖表庫：ECharts
- HTTP 客戶端：Axios
- 報告生成：jsPDF、xlsx

**應用層（後端）**：
- Web 框架：FastAPI
- 資料驗證：Pydantic
- 最佳化求解器：PuLP
- 資料庫客戶端：Supabase Python Client

**資料層（資料庫）**：
- 資料庫系統：Supabase（PostgreSQL）
- 核心資料表：projects、project_activities、activity_precedences、bidding_scenarios、optimization_results、activity_schedules

### 3.2 資料庫設計

資料庫採用關聯式設計，核心資料表及其關係如下：

1. **projects（專案主表）**：儲存專案基本資訊（名稱、描述、狀態）
2. **project_activities（作業活動表）**：儲存各專案的作業資訊（正常/趕工工期與成本）
3. **activity_precedences（前置關係表）**：儲存作業之間的前置關係（多對多關聯）
4. **bidding_scenarios（投標情境表）**：儲存優化計算的輸入參數（模式、約束、獎懲條款）
5. **optimization_results（優化結果表）**：儲存優化計算的輸出結果（最優工期、成本、獎懲金額）
6. **activity_schedules（作業排程表）**：儲存各作業的最佳排程（開始/結束時間、是否趕工）

資料表之間透過外鍵（Foreign Key）建立關聯，並設定級聯刪除（ON DELETE CASCADE）確保資料完整性。所有數值資料皆設定檢查約束（CHECK Constraint），例如趕工工期必須小於等於正常工期、趕工成本必須大於等於正常成本。

### 3.3 系統功能模組

系統包含以下核心功能模組：

**1. 專案管理模組**：
- 專案 CRUD（建立、讀取、更新、刪除）
- 專案狀態管理（草稿、進行中、已完成）
- 專案資料驗證

**2. 作業活動管理模組**：
- 作業 CRUD 操作
- 作業資料驗證（工期、成本合理性檢查）
- 前置關係設定與驗證（避免循環依賴）
- CSV 批次匯入功能

**3. 投標最佳化決策模組**：
- 模式一：給定預算，求最短工期
- 模式二：給定工期，求最低成本
- 獎懲條款計算（逾期違約金、提前獎金）
- 間接成本計算
- MILP 模型求解

**4. 結果分析與視覺化模組**：
- 結果摘要展示（最優工期、成本、獎懲金額）
- 甘特圖（作業排程視覺化）
- 成本分析圖（各作業成本分佈）
- 作業排程明細表
- 最佳化計算過程說明

**5. 報告輸出模組**：
- PDF 報告生成
- Excel 報告生成（多工作表）

---

## 第四章 數學模型建構

### 4.1 問題定義與符號說明

**集合與索引**：
- \(I\)：作業活動集合
- \(i, j\)：作業活動索引，\(i, j \in I\)
- \(P\)：前置關係集合，\(P \subseteq I \times I\)

**參數**：
- \(D_i^n\)：作業 \(i\) 的正常工期（天）
- \(C_i^n\)：作業 \(i\) 的正常成本
- \(D_i^c\)：作業 \(i\) 的趕工工期（天），\(D_i^c \leq D_i^n\)
- \(C_i^c\)：作業 \(i\) 的趕工成本，\(C_i^c \geq C_i^n\)
- \(B\)：預算約束（僅模式一）
- \(T_{max}\)：工期約束（僅模式二）
- \(T_{target}\)：目標工期（用於計算獎懲）
- \(r_p\)：逾期違約金率（每日）
- \(r_b\)：提前完工獎金率（每日）
- \(IC\)：間接成本（每日）
- \(CA\)：契約決標總價
- \(CD\)：契約工期

**決策變數**：
- \(x_i\)：作業 \(i\) 的開始時間（連續變數，\(x_i \geq 0\)）
- \(y_i\)：作業 \(i\) 是否趕工（二元變數，\(y_i \in \{0, 1\}\)）
- \(T\)：專案總工期（連續變數，\(T \geq 0\)）

### 4.2 模式一：給定預算，求最短工期

**目標函數**：

最小化總工期加上違約金減去獎金：

\[
\min Z = T + \text{Penalty} - \text{Bonus}
\]

其中：
- 違約金計算：若 \(T > T_{target}\)，則 \(\text{Penalty} = r_p \times (T - T_{target}) \times CA\)
- 獎金計算：若 \(T < T_{target}\)，則 \(\text{Bonus} = \min\left(\frac{CA}{CD} \times 0.05 \times (T_{target} - T), 0.01 \times CA\right)\)

**約束條件**：

1. **前置作業約束**：後續作業必須在前置作業完成後才能開始

\[
x_j \geq x_i + D_i^n \times (1 - y_i) + D_i^c \times y_i, \quad \forall (i, j) \in P
\]

2. **專案工期定義**：專案總工期必須大於等於所有作業的完成時間

\[
T \geq x_i + D_i^n \times (1 - y_i) + D_i^c \times y_i, \quad \forall i \in I
\]

3. **預算約束**：總成本（直接成本加間接成本）不得超過預算

\[
\sum_{i \in I} \left[ C_i^n \times (1 - y_i) + C_i^c \times y_i \right] + IC \times T \leq B
\]

4. **變數定義**：

\[
x_i \geq 0, \quad y_i \in \{0, 1\}, \quad T \geq 0, \quad \forall i \in I
\]

### 4.3 模式二：給定工期，求最低成本

**目標函數**：

最小化總成本（直接成本加間接成本）加上違約金減去獎金：

\[
\min Z = \sum_{i \in I} \left[ C_i^n \times (1 - y_i) + C_i^c \times y_i \right] + IC \times T + \text{Penalty} - \text{Bonus}
\]

**約束條件**：

1. **前置作業約束**：

\[
x_j \geq x_i + D_i^n \times (1 - y_i) + D_i^c \times y_i, \quad \forall (i, j) \in P
\]

2. **專案工期定義**：

\[
T \geq x_i + D_i^n \times (1 - y_i) + D_i^c \times y_i, \quad \forall i \in I
\]

3. **工期約束**：專案總工期必須符合約束條件

\[
T = T_{max}
\]

（在實作中透過將 T 的上下界都設為 \(T_{max}\) 來實現）

4. **變數定義**：

\[
x_i \geq 0, \quad y_i \in \{0, 1\}, \quad T = T_{max}, \quad \forall i \in I
\]

### 4.4 獎懲條款計算

**違約金計算**：

支援兩種計算方式：

1. **定額違約金**：\(\text{Penalty} = P_{amount} \times \max(0, T - T_{target})\)
2. **比率違約金**：\(\text{Penalty} = r_p \times CA \times \max(0, T - T_{target})\)

違約金上限：\(\text{Penalty} \leq 0.2 \times CA\)（契約價金總額的 20%）

**提前獎金計算**：

\[
\text{Bonus} = \min\left( \frac{CA}{CD} \times 0.05 \times \max(0, T_{target} - T), 0.01 \times CA \right)
\]

獎金計算方式為：每提前一天，獲得「契約決標總價除以契約工期」乘以 5% 的獎金，但獎金總額不得超過契約決標總價的 1%。

**總成本計算**：

\[
\text{Total Cost} = \text{Direct Cost} + \text{Indirect Cost} + \text{Penalty} - \text{Bonus}
\]

其中：
- 直接成本 = \(\sum_{i \in I} \left[ C_i^n \times (1 - y_i) + C_i^c \times y_i \right]\)
- 間接成本 = \(IC \times T\)

---

## 第五章 系統實作與功能展示

### 5.1 技術實作細節

**後端 MILP 模型實作**：

系統使用 PuLP 套件建構 MILP 模型，核心類別為 `BiddingOptimizer`。模型建構流程如下：

1. 初始化問題：`pulp.LpProblem(name, sense)`
2. 定義決策變數：`pulp.LpVariable(name, lowBound, upBound, cat)`
3. 設定目標函數：`problem += objective_expression`
4. 新增約束條件：`problem += constraint_expression`
5. 求解：`problem.solve(pulp.PULP_CBC_CMD(msg=0))`
6. 提取解：`pulp.value(variable)`

模型求解採用 CBC（COIN-OR Branch and Cut）求解器，為開源且效能穩定的 MILP 求解器。對於一般規模專案（少於 50 個作業），求解時間通常在 10 秒以內。

**前端視覺化實作**：

系統使用 ECharts 繪製甘特圖與成本分析圖。甘特圖以橫向條狀圖呈現各作業的時間區間，趕工作業以紅色標示，正常作業以綠色標示。成本分析圖以柱狀圖呈現各作業的成本分佈，便於識別高成本作業。

**報告生成實作**：

PDF 報告使用 jsPDF 套件生成，包含結果摘要與作業排程表。Excel 報告使用 xlsx（SheetJS）套件生成，包含兩個工作表：結果摘要與作業排程明細，並設定適當的欄寬與格式。

### 5.2 系統操作流程

**典型使用流程**：

1. **建立專案**：輸入專案名稱、描述與狀態
2. **定義作業活動**：輸入各作業的正常/趕工工期與成本，設定前置關係
3. **設定優化參數**：選擇決策模式（預算→工期或工期→成本），輸入約束條件與獎懲參數
4. **執行優化計算**：系統呼叫後端 API，建構並求解 MILP 模型
5. **查看結果**：檢視結果摘要、甘特圖、成本分析圖與作業排程表
6. **匯出報告**：生成 PDF 或 Excel 報告供後續使用

### 5.3 資料驗證機制

系統實作多層次資料驗證：

**前端驗證**：使用 Element Plus 表單驗證，即時檢查輸入資料格式與範圍
**後端驗證**：使用 Pydantic 資料模型，確保 API 接收的資料符合規格
**資料庫驗證**：透過 CHECK 約束與外鍵約束，確保資料完整性

驗證規則包括：
- 趕工工期必須小於等於正常工期
- 趕工成本必須大於等於正常成本
- 所有數值必須為正數
- 前置關係不得形成循環

---

## 第六章 研究成果與貢獻

### 6.1 系統功能成果

本研究成功開發一套完整的營造廠決策分析平台，具備以下功能：

1. **專案與作業管理**：完整的 CRUD 功能，支援手動輸入與 CSV 批次匯入
2. **雙模式最佳化決策**：提供預算約束與工期約束兩種決策模式
3. **獎懲條款整合**：考慮違約金與獎金，提供更準確的總成本評估
4. **視覺化分析**：提供甘特圖、成本分析圖等多種視覺化工具
5. **報告自動生成**：支援 PDF 與 Excel 兩種格式的報告匯出
6. **響應式設計**：支援桌面與行動裝置，提供良好的使用體驗

### 6.2 技術貢獻

**SSOT 架構設計**：
本系統以單一資料來源為核心，建立可擴充的資料架構，為未來新增功能模組奠定基礎。所有模組共用相同的專案與作業資料結構，確保資料一致性。

**MILP 模型整合**：
成功將整數線性規劃模型整合至 Web 應用程式，透過 FastAPI 提供高效的 API 服務。模型設計考慮獎懲條款、間接成本等實務因素，提供更貼近實際需求的最佳化結果。

**模組化架構**：
採用前後端分離、API 驅動的架構，各功能模組具有高度獨立性與可測試性。前端採用 Vue 3 組合式 API，後端採用 FastAPI 路由設計，便於維護與擴充。

### 6.3 實務應用價值

**投標決策支援**：
系統可協助營造廠在投標階段快速評估不同方案，量化分析工期與成本的權衡關係，提供科學化的決策依據，降低決策風險。

**情境分析能力**：
使用者可快速調整參數（預算、工期、獎懲條款等），進行多種情境分析，比較不同方案的優劣，找出最適合的投標策略。

**資料累積與重用**：
系統將專案資料結構化儲存，便於未來參考與重用。歷史專案資料可作為新專案的參考基準，提升估算準確度。

---

## 第七章 結論與未來展望

### 7.1 研究結論

本研究成功開發一套營造廠決策分析平台，實作投標最佳化決策系統，達成以下目標：

1. 建立以 SSOT 為核心的資料架構，確保資料一致性與可擴充性
2. 運用 MILP 模型提供科學化的工期成本最佳化決策
3. 整合獎懲條款計算，提供更完整的總成本評估
4. 提供直觀的視覺化工具與報告輸出功能
5. 採用模組化架構，為未來功能擴充奠定基礎

系統已具備實務應用價值，可協助營造廠提升投標決策效率與準確度，降低決策風險，增強競爭力。

### 7.2 未來研究方向

**功能擴充**：

1. **資源限制考量**：納入人力、機具等資源限制，使模型更貼近實務
2. **不確定性分析**：考慮工期與成本的不確定性，提供風險評估功能
3. **多專案排程**：支援多個專案的同時排程與資源分配
4. **即時進度追蹤**：整合實際進度資料，提供進度落後警示與趕工建議
5. **品質管理模組**：整合品質檢查點與品質成本分析
6. **現金流量分析**：提供專案現金流量預測與融資需求評估

**技術改進**：

1. **使用者認證系統**：新增帳號管理與權限控制功能
2. **協作功能**：支援多使用者同時編輯與版本控制
3. **行動應用程式**：開發原生行動 App，提供更好的行動體驗
4. **AI 輔助決策**：運用機器學習預測工期與成本，提升估算準確度
5. **即時通知**：提供即時通知與警示功能

### 7.3 研究限制

本研究存在以下限制：

1. **確定性假設**：工期與成本假設為確定值，未考慮不確定性
2. **資源忽略**：未考慮資源限制，可能導致實務上無法執行
3. **單一專案**：僅支援單一專案最佳化，未考慮多專案情境
4. **簡化的獎懲計算**：獎懲公式較為簡化，實務上可能更複雜

儘管存在上述限制，本系統仍具備良好的實用性與擴充性，可作為營造決策支援的基礎平台，並透過持續改進與擴充，逐步提升功能完整性與實務適用性。

---

## 附錄

### 附錄 A：系統技術規格

**前端技術棧**：
- Vue 3.5.24
- Vite 7.2.2
- Element Plus 2.8.0
- ECharts 5.5.0
- Axios 1.7.7
- jsPDF 2.5.2
- xlsx 0.18.5

**後端技術棧**：
- Python 3.9+
- FastAPI 0.115.0
- PuLP 2.8.0
- Pydantic 2.9.2
- Supabase Python Client 2.8.0

**資料庫**：
- PostgreSQL (via Supabase)

### 附錄 B：資料庫結構

**核心資料表**：
1. projects：專案主表
2. project_activities：作業活動表
3. activity_precedences：前置關係表
4. bidding_scenarios：投標情境表
5. optimization_results：優化結果表
6. activity_schedules：作業排程表

### 附錄 C：API 端點

**專案管理 API**：
- GET /projects：取得專案列表
- POST /projects：建立專案
- PUT /projects/{id}：更新專案
- DELETE /projects/{id}：刪除專案

**作業管理 API**：
- GET /activities：取得作業列表
- POST /activities：建立作業
- PUT /activities/{id}：更新作業
- DELETE /activities/{id}：刪除作業

**優化計算 API**：
- POST /optimization/optimize：執行優化計算
- GET /optimization/results/{id}：取得優化結果

---

**報告完成日期**：2025 年 1 月  
**專案版本**：1.0.0  
**系統狀態**：已完成並可運行


