# 產品需求文件 (PRD)

## 專案概述

**專案名稱**：營造廠決策分析平台  
**版本**：1.0.0  
**建立日期**：2025年

### 專案目標

建立一個以單一資料來源（SSOT）為核心的營造決策分析平台，首個核心模組為「投標最佳化決策系統」。平台旨在協助營造廠於投標階段以量化方式快速獲得最優工期與成本方案，並作為未來其他營建管理工具的共同運算基礎。

### 核心價值

1. **單一資料來源（SSOT）**：建立共用的專案資料與作業資料架構，確保未來新增模組時能直接沿用相同資料結構
2. **模組化設計**：支援未來擴充如品質管理、作業進度管理等模組
3. **量化決策支援**：採用整數線性規劃（MILP）模型，提供科學化的決策依據
4. **可重現性**：所有計算結果可追溯、可重現

## 功能需求

### 1. 專案管理

#### 1.1 專案 CRUD
- **建立專案**：使用者可建立新專案，包含專案名稱、描述、狀態
- **查詢專案**：列出所有專案，支援依狀態篩選
- **更新專案**：修改專案資訊
- **刪除專案**：刪除專案及其相關資料（級聯刪除）

#### 1.2 專案狀態管理
- 支援狀態：草稿（draft）、進行中（active）、已完成（completed）

### 2. 作業活動管理

#### 2.1 作業活動 CRUD
- **建立作業**：定義作業活動的基本資訊
  - 作業名稱、描述
  - 正常工期（天）
  - 正常成本
  - 趕工工期（天）
  - 趕工成本
- **查詢作業**：列出專案的所有作業活動
- **更新作業**：修改作業資訊
- **刪除作業**：刪除作業及其前置關係
- **列表顯示**：作業清單需同時顯示正常/趕工工期與成本，方便快速審視不同作業的趕工差異

#### 2.2 前置作業關係管理
- 設定作業的前置作業（支援多個前置作業）
- 驗證前置關係的合理性（避免循環依賴）

#### 2.3 資料驗證
- 趕工工期必須 ≤ 正常工期
- 趕工成本必須 ≥ 正常成本
- 所有數值必須為正數

### 3. 投標最佳化決策

#### 3.1 決策模式

**模式一：給定預算，求最短工期**
- 輸入：預算約束
- 輸出：最優工期、最優成本、作業排程

**模式二：給定工期，求最低成本**
- 輸入：工期約束
- 輸出：最優成本、最優工期、作業排程

#### 3.2 獎懲條款
- **逾期違約金**：可設定每日違約金率，計算逾期天數的違約金
- **趕工獎金**：可設定每日獎金率，計算提前完成天數的獎金
- **目標工期**：用於計算獎懲的基準工期（可選）

#### 3.3 優化計算
- 使用整數線性規劃（MILP）模型
- 求解器：PuLP（Python）
- 支援約束條件：
  - 前置作業約束
  - 預算/工期約束
  - 工期約束

### 4. 結果分析與視覺化

#### 4.1 結果展示
- 最優工期、最優成本
- 違約金、獎金金額
- 總成本（含獎懲）
- 計算時間

#### 4.2 圖表視覺化
- **甘特圖**：展示作業排程，標示趕工作業
- **成本分析圖**：展示各作業的成本分佈

#### 4.3 作業排程表
- 詳細列出每個作業的：
  - 開始時間、結束時間
  - 工期
  - 是否趕工
  - 成本

### 5. 報告輸出

#### 5.1 PDF 報告
- 使用 jsPDF 生成
- 包含：結果摘要、作業排程表

#### 5.2 Excel 報告
- 使用 xlsx 生成
- 包含多個工作表：
  - 結果摘要
  - 作業排程明細

## 技術架構

### 前端技術棧
- **框架**：Vue 3 + Vite
- **UI 元件庫**：Element Plus
- **圖表庫**：ECharts
- **HTTP 客戶端**：Axios
- **PDF 生成**：jsPDF
- **Excel 生成**：xlsx (SheetJS)

### 後端技術棧
- **框架**：FastAPI
- **求解器**：PuLP (MILP)
- **資料驗證**：Pydantic
- **資料庫**：Supabase (PostgreSQL)

### 資料庫架構

#### 核心資料表
1. **projects** - 專案主表
2. **project_activities** - 作業活動表
3. **activity_precedences** - 作業前置關係表
4. **bidding_scenarios** - 投標情境表
5. **optimization_results** - 優化結果表
6. **activity_schedules** - 作業排程表

## 非功能需求

### 效能需求
- 優化計算時間：一般專案（< 50 個作業）應在 10 秒內完成
- 頁面載入時間：< 2 秒

### 可用性需求
- 介面語言：繁體中文
- 響應式設計：支援桌面、平板與手機裝置

### 安全性需求
- API 應實作適當的驗證與授權（未來擴充）
- 資料驗證：前後端雙重驗證

### 可維護性需求
- 程式碼註解：所有程式碼需包含繁體中文註解
- 文件完整性：維護 PRD、使用者手冊、功能對應表

## 未來擴充

### 規劃中的模組
1. **品質管理模組**：沿用相同專案與作業資料結構
2. **作業進度管理模組**：追蹤實際進度與計劃進度
3. **成本控制模組**：實際成本與預算對比分析

### 技術改進
1. 使用者認證與授權系統
2. 多使用者協作功能
3. 歷史版本追蹤
4. 更豐富的視覺化圖表

## 版本歷史

| 版本 | 日期 | 說明 |
|------|------|------|
| 1.0.0 | 2024 | 初始版本，包含投標最佳化決策系統 |

