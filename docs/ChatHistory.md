# 開發決策紀錄

本文檔記錄開發過程中的重要決策與變更脈絡。

## 專案初始化階段

### 2024年 - 專案啟動

**決策**：採用前後端分離架構

**理由**：
- 前端使用 Vue 3，提供良好的使用者體驗
- 後端使用 FastAPI，提供高效的 API 服務
- 分離架構便於未來擴充與維護

**技術選型**：
- 前端：Vue 3 + Vite + Element Plus + ECharts
- 後端：Python + FastAPI + PuLP
- 資料庫：Supabase (PostgreSQL)

## 資料庫設計階段

### 決策：採用 SSOT（單一資料來源）架構

**理由**：
- 確保資料一致性
- 支援未來模組擴充
- 避免資料重複與不一致問題

**實作**：
- 建立核心資料表：projects, project_activities
- 設計可擴充的資料結構
- 使用外鍵關聯確保資料完整性

### 決策：使用 Supabase 作為資料庫

**理由**：
- 提供 PostgreSQL 資料庫
- 內建 RESTful API
- 支援即時訂閱（未來擴充）
- 易於部署與管理

## MILP 模型實作階段

### 決策：使用 PuLP 作為求解器

**理由**：
- Python 生態系統成熟
- 支援多種求解器（CBC, Gurobi 等）
- 開源且免費
- 易於整合到 FastAPI

**實作細節**：
- 定義決策變數：x[i]（開始時間）、y[i]（是否趕工）、T（總工期）
- 約束條件：前置作業約束、工期約束、預算約束
- 目標函數：最小化工期或成本（含獎懲）

### 決策：支援兩種決策模式

**模式一：給定預算，求最短工期**
- 適用情境：預算有限，需要最短工期
- 約束：總成本 ≤ 預算
- 目標：最小化工期 + 違約金 - 獎金

**模式二：給定工期，求最低成本**
- 適用情境：工期有限，需要最低成本
- 約束：總工期 ≤ 目標工期
- 目標：最小化總成本 + 違約金 - 獎金

## 前端開發階段

### 決策：使用 Element Plus 作為 UI 元件庫

**理由**：
- 繁體中文支援良好
- 元件豐富且易用
- 與 Vue 3 整合良好
- 文件完整

### 決策：使用 ECharts 作為圖表庫

**理由**：
- 功能強大，支援多種圖表類型
- 中文文件完整
- 效能優異
- 可自訂性高

### 決策：使用 vue-echarts 整合 ECharts

**理由**：
- 提供 Vue 3 元件封裝
- 易於使用與維護
- 支援響應式更新

## 報告輸出功能

### 決策：前端生成報告（PDF/Excel）

**理由**：
- 減少後端負擔
- 提升使用者體驗（即時生成）
- 降低伺服器資源消耗

**實作**：
- PDF：使用 jsPDF
- Excel：使用 xlsx (SheetJS)

**限制**：
- jsPDF 對中文支援有限（需要額外字體）
- 複雜格式可能需要後端支援

## 資料驗證策略

### 決策：前後端雙重驗證

**前端驗證**：
- 即時回饋，提升使用者體驗
- 減少不必要的 API 請求

**後端驗證**：
- 確保資料安全性
- 防止惡意請求
- 使用 Pydantic 進行嚴格驗證

## 錯誤處理策略

### 決策：統一錯誤處理

**前端**：
- 使用 Axios 攔截器統一處理錯誤
- 顯示友善的錯誤訊息

**後端**：
- 使用 FastAPI 的 HTTPException
- 返回結構化的錯誤訊息

## 未來擴充規劃

### 規劃中的功能

1. **使用者認證與授權**
   - 使用 Supabase Auth
   - 實作角色權限管理

2. **多使用者協作**
   - 專案共享功能
   - 即時協作編輯

3. **歷史版本追蹤**
   - 記錄優化結果的歷史版本
   - 支援版本比較

4. **更豐富的視覺化**
   - 3D 甘特圖
   - 互動式圖表

### 技術改進方向

1. **效能優化**
   - 大型專案的優化計算優化
   - 前端虛擬滾動

2. **可維護性**
   - 單元測試
   - 整合測試
   - 程式碼覆蓋率

3. **部署與 DevOps**
   - CI/CD 流程
   - 自動化測試
   - 容器化部署

## 已知問題與限制

### 1. jsPDF 中文支援

**問題**：jsPDF 預設不支援中文字體

**解決方案**：
- 目前使用簡化版本
- 未來可引入中文字體（如 Noto Sans CJK）

### 2. 大型專案效能

**問題**：作業數量過多時，優化計算可能較慢

**解決方案**：
- 使用更強大的求解器（如 Gurobi）
- 實作計算進度回報
- 考慮非同步計算

### 3. 前置關係驗證

**問題**：目前未實作循環依賴檢測

**解決方案**：
- 實作圖論演算法檢測循環
- 在建立/更新作業時驗證

## 變更日誌

### v1.0.0 (2024)

**新增功能**：
- 專案管理（CRUD）
- 作業活動管理（CRUD）
- 前置作業關係管理
- 投標最佳化決策（兩種模式）
- 獎懲條款計算
- 結果分析與視覺化
- PDF/Excel 報告匯出

**技術架構**：
- 前端：Vue 3 + Element Plus + ECharts
- 後端：FastAPI + PuLP
- 資料庫：Supabase (PostgreSQL)

### 2025-11-21

**介面調整**：
- 作業活動管理列表新增「正常工期／正常成本／趕工工期／趕工成本」欄位，對應 `src/components/ActivityTable.vue`
- 更新 PRD、使用者手冊與功能程式碼對應表，同步描述新欄位需求與實作

**理由**：
- 使用者需要在不開啟編輯視窗的情況下即時比對正常與趕工參數，縮短資料驗證時間

### 2025-11-22

**行動版優化**：
- `src/components/ActivityTable.vue` 新增手機偵測與卡片式佈局，所有輸入欄位支援全寬操作
- `src/views/ProjectManagement.vue` 新增專案卡片版、手機尺寸偵測與樣式
- `docs/PRD.md`、`docs/UserManual.md`、`docs/FeatureCodeMap.md` 更新行動支援描述

**理由**：
- 確保使用者在手機上也能管理專案與作業、閱讀欄位資訊並完成編輯或刪除動作

---

**版本**：1.0.0  
**最後更新**：2024年

